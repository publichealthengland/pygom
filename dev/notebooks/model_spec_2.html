

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Defining a system of differential equations &#8212; PyGOM documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/model_spec_2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ODE Insights" href="insights.html" />
    <link rel="prev" title="Mathematical description" href="solution.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../md/intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_pygom.jpg" class="logo__image only-light" alt="PyGOM documentation - Home"/>
    <script>document.write(`<img src="../_static/logo_pygom.jpg" class="logo__image only-dark" alt="PyGOM documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../md/intro.html">
                    Welcome to the documentation for PyGOM
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../md/installation.html">Installation</a></li>

<li class="toctree-l1"><a class="reference internal" href="../md/building_doc.html">Building the documentation locally</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Compartmental models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="definition.html">Introduction</a></li>

<li class="toctree-l1"><a class="reference internal" href="solution.html">Mathematical description</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PyGOM workflow</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Defining a system of differential equations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="insights.html">ODE Insights</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="extract_info.html">Extracting model information</a></li>
<li class="toctree-l2"><a class="reference internal" href="unroll/unrollSimple.html">Deducing transitions from equations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../md/solving.html">Producing forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="model_params.html">Parameterisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_solver.html">Finding ODE solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_dependent_params.html">Time dependent parameters</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../md/parameter_fitting.html">Parameter fitting</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="paramfit/params_via_abc.html">Parameter Estimation: Approximate Bayesian Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="paramfit/params_via_optimization.html">Parameter Estimation: Maximum likelihood</a></li>
<li class="toctree-l2"><a class="reference internal" href="paramfit/bvpSimple.html">Solving Boundary Value Problems</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="epijson.html">Reading and using EpiJSON data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Common biological compartmental models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../md/common_models.html">Pre-defined examples - common epi models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="common_models/SIS.html">SIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SIR.html">SIR</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SEIR.html">SEIR</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SIS_Periodic.html">SIS, periodic</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SIR_Birth_Death.html">SIR, birth and death</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SEIR_Multiple.html">SEIR, multiple</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/SEIR_Birth_Death_Periodic_Waning_Intro.html">SEIR, birth, death, periodic, waning and introductions</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/Legrand_Ebola_SEIHFR.html">Legrand Ebola SEIHFR</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/Lotka_Volterra.html">Lotka Volterra</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_models/FitzHugh.html">FitzHugh</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Frequently asked questions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../md/faq.html">Frequently asked questions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Code documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../rst/autodoc-model.html">model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rst/autodoc-loss.html">loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rst/autodoc-abc.html">approximate_bayesian_computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rst/autodoc-utilR.html">utilR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../md/bib.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ukhsa-collaboration/pygom" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ukhsa-collaboration/pygom/issues/new?title=Issue%20on%20page%20%2Fnotebooks/model_spec_2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/model_spec_2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Defining a system of differential equations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#events-and-transitions">Events and Transitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-sir-model-example">Basic SIR model example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinary-differential-equations">Ordinary Differential Equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-odes-and-transitions">Combining ODEs and Transitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ode-vs-event-definition-in-pygom">ODE vs Event definition in PyGOM</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="defining-a-system-of-differential-equations">
<h1>Defining a system of differential equations<a class="headerlink" href="#defining-a-system-of-differential-equations" title="Permalink to this heading">#</a></h1>
<p>When using PyGOM to study a compartmental model or series of ODEs, the starting point is to encapsulate the relevant information into a class <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.SimulateOde" title="pygom.model.SimulateOde"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulateOde</span></code></a>.
Once defined as an instance of this class, the system is ready for the application of PyGOM’s various features such as simulation and parameter fitting.</p>
<section id="events-and-transitions">
<h2>Events and Transitions<a class="headerlink" href="#events-and-transitions" title="Permalink to this heading">#</a></h2>
<p>If we are dealing with a compartmental model, the easiest way to define this is by feeding <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> and <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Event" title="pygom.model.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a> objects into the central class, <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.SimulateOde" title="pygom.model.SimulateOde"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulateOde</span></code></a>.
We demonstrate how this is done via the example of an SIR model with some added features.</p>
<section id="basic-sir-model-example">
<h3>Basic SIR model example<a class="headerlink" href="#basic-sir-model-example" title="Permalink to this heading">#</a></h3>
<p>We first import the relevant modules:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pygom</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Transition</span><span class="p">,</span> <span class="n">SimulateOde</span>
</pre></div>
</div>
</div>
</div>
<p>Next we specify the names of the states and parameters, which we can declare as lists.
Since we will most commonly be dealing with states which represent the counts of something, PyGOM will assume that the states are constrained to have a minimum value of zero and no upper bound.
If this is not the case, we can inform PyGOM about such limits by declaring the state as a tuple, with the first element being the state name and the second being another tuple containing the minimum and maximum allowed values.
We demonstrate below how this is done, even though in this case it’s not necessary as we are specifying the default limits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
<span class="n">states</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))]</span>
<span class="c1"># equivalent to:</span>
<span class="c1"># states=[&#39;S&#39;, &#39;I&#39;, &#39;R&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Transitions are encapsulated in a <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> class.
We signify that a transition is between states by setting <code class="docutils literal notranslate"><span class="pre">transition_type</span></code>=’T’ and must also provide the origin and destination.
An <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Event" title="pygom.model.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a> object is then defined by the transition (or transitions) and the rate at which it occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Infection</span>
<span class="c1">## Transition</span>
<span class="n">transition_infection</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="c1">## Event</span>
<span class="n">event_infection</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">transition_infection</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;beta*S*I/N&#39;</span><span class="p">)</span>

<span class="c1"># 2) Recovery</span>
<span class="c1">## Transition</span>
<span class="n">transition_recovery</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="c1">## Event</span>
<span class="n">event_recovery</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">transition_recovery</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;gamma*I&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We are now ready to initialise the model object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">=</span><span class="n">SimulateOde</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="p">[</span><span class="n">event_infection</span><span class="p">,</span> <span class="n">event_recovery</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We can check that the state change matrix (introduced as <span class="math notranslate nohighlight">\(\mathcal{D}\)</span> <a class="reference internal" href="solution.html"><span class="doc">previously</span></a>), in which the columns correspond to events and the rows to the associated changes in the variables, is what we’d expect:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">get_StateChangeMatrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}-1 &amp; 0\\1 &amp; -1\\0 &amp; 1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>and we can also verify the event rate vector (<span class="math notranslate nohighlight">\(\boldsymbol{\lambda}\)</span> from <a class="reference internal" href="solution.html"><span class="doc">before</span></a>) is correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">get_EventRateVector</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}\frac{I S \beta}{N}\\I \gamma\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>We can actually get away with a more shorthand approach in the model definition.
PyGOM assumes that the magnitude of a transition is 1 unless told otherwise, so there is no need to specify the <code class="docutils literal notranslate"><span class="pre">magnitude</span></code> argument here.
Also, both events only involve one transition each, so it’s a bit cumbersome to always have to wrap a <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> within an <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Event" title="pygom.model.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a>.
A shorthand is to add the rate information to the <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a>, this time as a parameter called <code class="docutils literal notranslate"><span class="pre">equation</span></code> and to feed the transitions in directly where we previously input the event list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Infection</span>
<span class="n">transition_infection</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;beta*S*I/N&#39;</span><span class="p">)</span>

<span class="c1"># 2) Recovery</span>
<span class="n">transition_recovery</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;gamma*I&#39;</span><span class="p">)</span>

<span class="c1"># (states and params already defined in previous code cell)</span>
<span class="n">model2</span><span class="o">=</span><span class="n">SimulateOde</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="p">[</span><span class="n">transition_infection</span><span class="p">,</span> <span class="n">transition_recovery</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>We briefly demonstrate that the end result is unchanged:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span><span class="o">.</span><span class="n">get_StateChangeMatrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}-1 &amp; 0\\1 &amp; -1\\0 &amp; 1\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span><span class="o">.</span><span class="n">get_EventRateVector</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}\frac{I S \beta}{N}\\I \gamma\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>When given a set of events and transitions, PyGOM can convert this into a set of ODEs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span><span class="o">.</span><span class="n">get_ode_eqn</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}- \frac{I S \beta}{N}\\- I \gamma + \frac{I S \beta}{N}\\I \gamma\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>and it can be helpful to verify visually that the model is defined as intended:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">=</span><span class="n">model2</span><span class="o">.</span><span class="n">get_transition_graph</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bac0eab1042e0db61dd2eecf6896d4aecb93c067a976055b079bb181760cfbe3.svg" src="../_images/bac0eab1042e0db61dd2eecf6896d4aecb93c067a976055b079bb181760cfbe3.svg" /></div>
</div>
</section>
<section id="more-complex-example">
<h3>More complex example<a class="headerlink" href="#more-complex-example" title="Permalink to this heading">#</a></h3>
<p>Let’s now extend the above model so that it covers all of the aspects outlined in the <a class="reference internal" href="definition.html"><span class="doc">introduction to compartmental models</span></a>.
Firstly, let’s introduce vital dynamics of birth and death.
The total population, <span class="math notranslate nohighlight">\(N\)</span>, will change if these rates are not balanced.
In fact, even if the rates are balanced, <span class="math notranslate nohighlight">\(N\)</span> is subject to vary due to stochastic imbalances between births and deaths.
To track the potential evolution of this variable, we change <span class="math notranslate nohighlight">\(N\)</span> from being a parameter to a state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Another way to allow <span class="math notranslate nohighlight">\(N\)</span> to vary is to define it as a derived parameter by passing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>derived_parameters=[(&#39;N&#39;, &#39;S+I+R&#39;)]
</pre></div>
</div>
<p>to <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.SimulateOde" title="pygom.model.SimulateOde"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulateOde</span></code></a></p>
</div>
<p>Birth and death <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> objects are indicated by <code class="docutils literal notranslate"><span class="pre">transition_type</span></code> B and D respectively and use <code class="docutils literal notranslate"><span class="pre">destination</span></code> and <code class="docutils literal notranslate"><span class="pre">origin</span></code> respectively to define the affected state.</p>
<p>We now show this in practice.
Whilst it is possible in PyGOM to build on previously existing models, when changing variable definitions we would recommend starting from scratch as we do here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">]</span>          <span class="c1"># now we have the birth rate parameter</span>
<span class="n">states</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>             <span class="c1"># now we are treating the population count as a state</span>

<span class="c1"># Transitions in and out of total population count</span>
<span class="c1"># These will be used in the following event definitions</span>
<span class="n">birth_N</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<span class="n">death_N</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>

<span class="c1"># 1) Birth event into S</span>
<span class="n">birth</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<span class="n">event_birth</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">birth</span><span class="p">,</span> <span class="n">birth_N</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;mu*N&#39;</span><span class="p">)</span>

<span class="c1"># 2) Death event of an S</span>
<span class="n">death_S</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">event_death_S</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">death_S</span><span class="p">,</span> <span class="n">death_N</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;mu*S&#39;</span><span class="p">)</span>

<span class="c1"># 3) Death event of an I</span>
<span class="n">death_I</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">event_death_I</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">death_I</span><span class="p">,</span> <span class="n">death_N</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;mu*I&#39;</span><span class="p">)</span>

<span class="c1"># 4) Death event of an R</span>
<span class="n">death_R</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">event_death_R</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">death_R</span><span class="p">,</span> <span class="n">death_N</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;mu*R&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">=</span><span class="n">SimulateOde</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="p">[</span><span class="n">event_infection</span><span class="p">,</span>
                                                     <span class="n">event_recovery</span><span class="p">,</span>
                                                     <span class="n">event_birth</span><span class="p">,</span>
                                                     <span class="n">event_death_S</span><span class="p">,</span>
                                                     <span class="n">event_death_I</span><span class="p">,</span>
                                                     <span class="n">event_death_R</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>As before, it’s a good idea to check that the transition graph makes sense:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_transition_graph</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7eb277e13ce8dc52d0505730dc9a5cfea9db11e7a004b7ddbda9ac2ed8ecc940.svg" src="../_images/7eb277e13ce8dc52d0505730dc9a5cfea9db11e7a004b7ddbda9ac2ed8ecc940.svg" /></div>
</div>
<p>Arrows in black represent transitions not correlated with any others.
Any non-black arrows which do share the same colour are correlated with each other and so are understood to change together when the underlying event occurs.
For example, the death of a recovered individual simultaneously decreases the <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(N\)</span> compartments by 1.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Whilst the colour pallette we have used is ostensibly friendly to those with colour-blindness, we appreciate that there is room for improvement.
If the user has installed the package in editable mode, they may wish to substitute in their preferred pallette by changing the <code class="docutils literal notranslate"><span class="pre">cols</span></code> variable of the <code class="docutils literal notranslate"><span class="pre">_transition_graph</span></code> module.</p>
</div>
<p>Let’s say we wish to replicate the <a class="reference internal" href="definition.html"><span class="doc">example</span></a> where we track the money spent, <span class="math notranslate nohighlight">\(M\)</span>, during the epidemic due to each infection event costing <span class="math notranslate nohighlight">\(c\)</span> units.
We also track the cumulative infections in <span class="math notranslate nohighlight">\(Itot\)</span>.
This is implemented by adding these as <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> instances to the infection <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Event" title="pygom.model.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a>.
Note that the cost transition requires us to specify the magnitude since it is not 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Redo old stuff:</span>

<span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">states</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Itot&#39;</span><span class="p">]</span>

<span class="c1"># Infection</span>
<span class="n">transition_infection</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">transition_cost</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>            <span class="c1"># we must declare the magnitude of the cost</span>
<span class="n">transition_count</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">destination</span><span class="o">=</span><span class="s1">&#39;Itot&#39;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="n">event_infection</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">transition_list</span><span class="o">=</span><span class="p">[</span><span class="n">transition_infection</span><span class="p">,</span> <span class="n">transition_cost</span><span class="p">,</span> <span class="n">transition_count</span><span class="p">],</span> <span class="n">rate</span><span class="o">=</span><span class="s1">&#39;beta*S*I/N&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">=</span><span class="n">SimulateOde</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="p">,</span>
                  <span class="n">param</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                  <span class="n">event</span><span class="o">=</span><span class="p">[</span><span class="n">event_infection</span><span class="p">,</span>
                         <span class="n">event_recovery</span><span class="p">,</span>
                         <span class="n">event_birth</span><span class="p">,</span>
                         <span class="n">event_death_S</span><span class="p">,</span>
                         <span class="n">event_death_I</span><span class="p">,</span>
                         <span class="n">event_death_R</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_transition_graph</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fefeb11beb09939a550318338f3d917ca5fd022cf563aa8116aff4dc76b736cd.svg" src="../_images/fefeb11beb09939a550318338f3d917ca5fd022cf563aa8116aff4dc76b736cd.svg" /></div>
</div>
<p>The <span class="math notranslate nohighlight">\(c\)</span> beside the arrowhead indicates that this transition occurs in steps of <span class="math notranslate nohighlight">\(c\)</span>.</p>
</section>
</section>
<section id="ordinary-differential-equations">
<h2>Ordinary Differential Equations<a class="headerlink" href="#ordinary-differential-equations" title="Permalink to this heading">#</a></h2>
<p>If we were not interested in stochastic dynamics, or our system cannot be visualised as a compartmental model, we might define our system via ODEs from the outset.
In general though, if a CTMC model does exist, it can be converted into a set of ODEs via:</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
\frac{\mathrm{d} y_i}{\mathrm{d} t}=\sum_{\text{transitions, }j} \mathcal{D}_{ij}\lambda_j
\end{aligned}\]</div>
<p>For the current example, this results in:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
\frac{\mathrm{d} S}{\mathrm{d} t} &amp;= -\frac{\beta S I}{N} + \mu N - \mu S\\
\frac{\mathrm{d} I}{\mathrm{d} t} &amp;= \frac{\beta S I}{N} - \gamma I - \mu I\\
\frac{\mathrm{d} R}{\mathrm{d} t} &amp;= \gamma I - \mu R\\
\frac{\mathrm{d} N}{\mathrm{d} t} &amp;= \mu N - \mu S - \mu I - \mu R = 0\\
\frac{\mathrm{d} I_{\mathrm{tot}}}{\mathrm{d} t} &amp;= \frac{\beta S I}{N}\\
\frac{\mathrm{d} M}{\mathrm{d} t} &amp;= \frac{c \beta S I}{N}
\end{aligned}\end{split}\]</div>
<p>To build a PyGOM object from this, we use <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> classes of the type, <code class="docutils literal notranslate"><span class="pre">ODE</span></code>, and pass a list of these in the <code class="docutils literal notranslate"><span class="pre">ode</span></code> argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dSdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;-beta*S*I/N + mu*N - mu*S&#39;</span><span class="p">)</span>
<span class="n">dIdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;beta*S*I - gamma*I - mu*I&#39;</span><span class="p">)</span>
<span class="n">dRdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;gamma*I - mu*R&#39;</span><span class="p">)</span>
<span class="n">dNdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="n">dMdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;beta*S*I/N&#39;</span><span class="p">)</span>
<span class="n">dItotdt</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">transition_type</span><span class="o">=</span><span class="s1">&#39;ODE&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;Itot&#39;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s1">&#39;c*beta*S*I/N&#39;</span><span class="p">)</span>

<span class="n">model_ode</span><span class="o">=</span><span class="n">SimulateOde</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">ode</span><span class="o">=</span><span class="p">[</span><span class="n">dSdt</span><span class="p">,</span> <span class="n">dIdt</span><span class="p">,</span> <span class="n">dRdt</span><span class="p">,</span> <span class="n">dNdt</span><span class="p">,</span> <span class="n">dMdt</span><span class="p">,</span> <span class="n">dItotdt</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>In choosing this path, we have closed the door on the possibility of stochastic simulations.
For instance, PyGOM now cannot derive a state change matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_ode</span><span class="o">.</span><span class="n">get_StateChangeMatrix</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\displaystyle \left[\begin{matrix}\\\\\\\\\\\end{matrix}\right]\end{split}\]</div>
</div>
</div>
<p>The transition graph is also not very informative.
We are basically provided with our set of ODEs with some adorning arrows (which are also dashed, as we see below this is useful to differentiate between deterministic and stochastic processes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">=</span><span class="n">model_ode</span><span class="o">.</span><span class="n">get_transition_graph</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ff0a621e35766d3a7f0442e9ecd12aa379bdbc7d0278ccfe3cea128cdbf467fc.svg" src="../_images/ff0a621e35766d3a7f0442e9ecd12aa379bdbc7d0278ccfe3cea128cdbf467fc.svg" /></div>
</div>
</section>
<section id="combining-odes-and-transitions">
<h2>Combining ODEs and Transitions<a class="headerlink" href="#combining-odes-and-transitions" title="Permalink to this heading">#</a></h2>
<p>There could be cases where our system contains both stochastic and deterministic elements.
In our current example, each infection costs <span class="math notranslate nohighlight">\(c\)</span> monetary units.
We could imagine this to be associated with one-off acute costs of the infection event such as a diagnostic test.
However, the symptoms which follow infection may introduce additional costs, say, <span class="math notranslate nohighlight">\(d\)</span> units per person per day, perhaps due to treatment or money lost due to days not worked.</p>
<p>These latter kind of effects we have just seen how to deal with, by using <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.Transition" title="pygom.model.Transition"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transition</span></code></a> objects of the type <code class="docutils literal notranslate"><span class="pre">ODE</span></code>.
It is then trivial to combine these, by using both the <code class="docutils literal notranslate"><span class="pre">event</span></code> and <code class="docutils literal notranslate"><span class="pre">ode</span></code> arguments of <a class="reference internal" href="../rst/autodoc-model.html#pygom.model.SimulateOde" title="pygom.model.SimulateOde"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimulateOde</span></code></a>.
In doing so below, we will also learn how to build on a previously created model.
We add any new parameters to the model <code class="docutils literal notranslate"><span class="pre">param_list</span></code> and our ODEs to the <code class="docutils literal notranslate"><span class="pre">ode</span></code> attribute:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disease_cost</span><span class="o">=</span><span class="n">Transition</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">equation</span><span class="o">=</span><span class="s2">&quot;I*d&quot;</span><span class="p">,</span> <span class="n">transition_type</span><span class="o">=</span><span class="s2">&quot;ODE&quot;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">param_list</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">param_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">ode_list</span><span class="o">=</span><span class="p">[</span><span class="n">disease_cost</span><span class="p">]</span>

<span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">get_transition_graph</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ee0d2eb7e52d8079461386a477f68e67b4954dd30fccb341f77354a7c8e0333d.svg" src="../_images/ee0d2eb7e52d8079461386a477f68e67b4954dd30fccb341f77354a7c8e0333d.svg" /></div>
</div>
<p>where the deterministic transition is indicated by a dashed line type.
The <span class="math notranslate nohighlight">\(c\)</span> magnitude indicator next to the blue arrowhead looks like it could instead be associated with the dashed arrowhead, so care needs to be taken when interpreting these graphs until this feature has been optimised.</p>
</section>
<section id="ode-vs-event-definition-in-pygom">
<h2>ODE vs Event definition in PyGOM<a class="headerlink" href="#ode-vs-event-definition-in-pygom" title="Permalink to this heading">#</a></h2>
<p>PyGOM allows the user flexibility in choosing which of these perspectives to use, or indeed combine if possible, in order to build their models.
If stochastic solutions are required, however, then PyGOM <em>must</em> know the underlying transitions.
The easiest way is to supply this information directly, however, <a class="reference internal" href="unroll/unrollSimple.html"><span class="doc">in some cases</span></a>, it can also attempt to reverse engineer transitions if ODE’s are instead supplied.
If stochastic solutions are not required (or, indeed, the system is not based on a compartmental model), then the system can be specified either in terms of ODEs or transitions (if applicable).</p>
<p>One advantage of specifying our system using the transition approach is that many will find transitions a more intuitive language when thinking about compartmental models.
Perhaps more beneficial, though, is that when building models with transitions using PyGOM, it enables the computer to do our book-keeping when converting transitions to ODE equations.
This reduces the error of, for example, including a flow out of one state, but forgetting to include it in the recipient state.
For example, in the case above, when indicating infections with <span class="math notranslate nohighlight">\(-\frac{\beta SI}{N}\)</span> in the <span class="math notranslate nohighlight">\(\frac{\mathrm{d}S}{\mathrm{d}t}\)</span> equation, we had to remember to include the opposite sign in the <span class="math notranslate nohighlight">\(\frac{\mathrm{d}I}{\mathrm{d}t}\)</span> equation.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="solution.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Mathematical description</p>
      </div>
    </a>
    <a class="right-next"
       href="insights.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ODE Insights</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#events-and-transitions">Events and Transitions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-sir-model-example">Basic SIR model example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinary-differential-equations">Ordinary Differential Equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-odes-and-transitions">Combining ODEs and Transitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ode-vs-event-definition-in-pygom">ODE vs Event definition in PyGOM</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By UK Health Security Agency (previously Public Health England)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>